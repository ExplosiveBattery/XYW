# 平行越权漏洞

<b>起始语：大概锐捷这家公司的开发人员觉得给了userIndex就万事大吉没有考虑JSESSION了吧</b>  

### 使用前提

- 同一个内网  
- 需要指导目标登录设备的ip与学号  

### 漏洞介绍

[校园网认证系统-RG-SAM-Portal组件-用户信息泄露漏洞](http://www.admintony.com/%E6%A0%A1%E5%9B%AD%E7%BD%91%E8%AE%A4%E8%AF%81%E7%B3%BB%E7%BB%9F-RG-SAM-Portal%E7%BB%84%E4%BB%B6-%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E.html)  
2018年6月5号记录：文章中关于分段的部分存在理解错误，作者认为第二部分是设备标识，但是实际上是ip，其中点变成2e，并像第三部分的学号一样穿插数字3  

### 漏洞场景

<b>【偶然相遇】</b>2018年6月5号，成都炎热的夏日挂在天空，ExplosiveBattery难得去了一次图书馆（为了凉空调），在门口无奈地看着图书馆的外表，再次心想这恐怕是我见过最难看的大学图书馆了吧。和从前一样，乘着电梯到了四楼（计软学科的书都在这一层楼）。垂着眼皮站在一堆专业书籍中，毫无精神的他随手拿了一本就找了个偏僻的位置坐下毫无目的地翻看。虽然是浏览，但是已经足以看出书上过时而过分基础的内容，心理喊了声mmp，便合上书甩到桌子一边去了，完全不清楚接下来应该做什么。在成都的夏季，毫无目的地四处看看总能看到什么惊喜，ExplosiveBattery有时就会靠这个办法来给自己带来偶尔的喜悦。毕竟成都的女孩子们都好好看啊。果不其然，即便是在这层基佬楼里，他还是找到了这么一位能给他带来喜悦的女生。两人相距的位置不是很远，不知道为什么，ExplosiveBattery觉得这次看到的女生每一个动作都仿佛在撩拨着他的灵魂一样，有种想要联系方式的冲动，但是ExplosiveBattery能单身到现在也并不是没有原因，他终归是一个羞涩的小处男。轻轻一撇发现那位女生刚用手机登录上SCUNET，好像忽然想到了什么，ExplosiveBattery瞬间变得精神起来！  
<b>【好戏开场】</b>ExplosiveBattery好不容易从书包里面找出一张看起来没有什么褶皱的纸，一笔一画地制作了一份匿名问卷调查：
![问卷](https://github.com/ExplosiveBattery/XYW/blob/master/SCUNET/parallel%20import/questionnaire.png?raw=true)  
然后他装成一个四处走动的人来到了女神边上，有礼貌地告知需要同学帮忙填写一份匿名问卷，为了避免引起厌烦，他强调这份问卷只有两个很简单的问题。当然，女神随意得便答应了这件事情。当ExplosiveBattery拿着问卷回到自己的位置上，他就知道自己终于找到一件很有意思的事情可以做了，既然已经知道了学号，那么剩下的问题就是ip。考虑到部分windows电脑的防火墙还是有点智能的，部分电脑还安装了360等异次元工具，没准能够躲开ARP扫描，ExplosiveBattery决定使用现成的工具netdiscover通过主被动扫描结合来获取当前子网内的情况，而不是自己在程序中编写主动扫描，过了一会，便有了成果：
![扫描结果](https://github.com/ExplosiveBattery/XYW/blob/master/SCUNET/parallel%20import/scan%20result.png?raw=true)  
首先尝试通过分析mac产商结合电脑品牌推断出ip，但是图书馆里面连接设备不少，很杂乱，无奈之下只好使用遍历的方式，将获取的内容复制到一个文本文件中，通过程序自动读取ip并进行格式转化，最后结合固定前缀与转话后的学号得到一条条可能userIndex，程序会自动不断尝试访问http://192.168.2.135/eportal/success.jsp?userIndex=xxx&keepaliveInterval=0 ，如果能进入主页面就说明ip正确。进去之后发现并不存在信息泄露的问题，可能有用信息只有女神的名字（真是一个好名字，大概每一个陷入爱情的人都是这么想的）和手机的mac地址，抱怨道难道我要做一辈子处男？正当在无路可走的时候，或许受到了想要认识女神的决心的激励，ExplosiveBattery发现了一个很简单的办法。他直接点击了下线按钮，并将无线网卡设置为monitor mode进行嗅探，等待着女神发现自己断网重新登录SCUNET。一切都在朝预料的方向发展，这个密码也正是女神本科系统登录密码，ok，大一堆信息（包括高中证件照）都被获取到了。  
<b>【结局】</b>ExplosiveBattery最终还是加上了女神的qq，并在几年之后被以同学的身份邀请参加女神的婚礼。  
<b>【为什么会是这结局？】</b>因为当年那个素颜证件照彻底惊讶了ExplosiveBattery，他的世界观仿佛瞬间崩塌一样，人生惨淡，好久之后回过神来，点了点头说：“化妆确实是门神功“。  

### 项目介绍

一个py脚本，通过正则表达式从文件中读取ip地址，构造可能的userIndex，然后将尝试将目标强制下线   
进入用户页面是可以得到目标当前登录设备的mac地址，如果你打算做一个长期恶作剧倒是可以记录下来，方便之后的内网嗅探  

### 相关补充

川大SCUNET的ip一般会是10.132.1.1/16  
netdiscover不适合扫OS X系统的设备  


